<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Perfil – Crece Diseño</title>

  <!-- Tipografías -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- AOS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet"/>

   <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet"/>

  <!-- Estilos del sitio (mismos de index) -->
  <link rel="stylesheet" href="../css/styles.css" />
  
</head>
<body>
  <!-- Fondo animado consistente -->
  <div class="background-container"></div>

  <!-- Header / Navbar igual a index -->
  <header class="shadow-sm">
    <nav class="navbar navbar-expand-lg bg-white-95 fixed-top custom-navbar" id="mainNavbar">
      <div class="container-fluid px-2 px-sm-3 px-lg-4">
        <!-- Marca a la izquierda -->
        <a class="navbar-brand d-flex align-items-center me-auto brand-left" href="../index.html">
          <img src="../recursos/logo.svg" alt="Crece Diseño" class="brand-logo" />
        </a>

        <!-- Toggler -->
        <button class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
                aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Links -->
        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav ms-auto align-items-lg-center">
            <li class="nav-item"><a class="nav-link" href="../index.html">Inicio</a></li>
            <li class="nav-item"><a class="nav-link" href="./cursos.html">Cursos</a></li>
            <li class="nav-item"><a class="nav-link" href="./nosotros.html">Nosotros</a></li>
            <li class="nav-item"><a class="nav-link" href="../html/foro.html">Foro</a></li>
            <li class="nav-item"><a class="nav-link active" href="./usuario.html">Mi Perfil</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <!-- Hero coherente con index -->
  <section class="hero hero-usuario" id="inicio">
    <div class="banner-container">
      <img src="../recursos/patron1.svg" alt="Patrón de fondo" />
    </div>
    <div class="container">
      <div class="hero-content center-block" data-aos="fade-up" data-aos-duration="800">
        <h1>Mi Perfil de Aprendizaje</h1>
        <p>Gestiona tus cursos seleccionados y sigue tu progreso de formación profesional.</p>
      </div>
    </div>
  </section>

  <main class="profile-content">
    <div class="container">
      <div class="row">
        <!-- Left column -->
        <div class="col-lg-8">
          <!-- About -->
          <div class="card" id="aboutCard" data-section="about">
            <div class="card-header"><h3 class="card-title">Acerca de mí</h3></div>
            <div class="card-body" id="aboutBody">
              <p class="about-text" data-editable="true">Diseñadora gráfica con 5 años de experiencia especializada en branding, ilustración digital y diseño UX/UI. Me apasiona crear identidades visuales que cuentan historias y resuelven problemas de comunicación.</p>
              <p class="about-text" data-editable="true">Actualmente trabajo como diseñadora senior en una agencia digital, donde lidero proyectos de diseño para clientes internacionales. Mi enfoque combina creatividad, estrategia y atención al detalle para entregar soluciones visuales efectivas.</p>
            </div>
          </div>

          <!-- Experience -->
          <div class="card" id="experienceCard" data-section="experience">
            <div class="card-header"><h3 class="card-title">Experiencia Profesional</h3></div>
            <div class="card-body" id="experienceBody">
              <div class="timeline">
                <div class="timeline-item" data-editable="true">
                  <div class="timeline-date">2021 - Presente</div>
                  <h4 class="timeline-title">Diseñadora Senior</h4>
                  <div class="timeline-company">Estudio Creativo Digital</div>
                  <p>Lidero proyectos de diseño de marca y experiencia de usuario para clientes internacionales. Superviso un equipo de 3 diseñadores junior.</p>
                </div>
                <div class="timeline-item" data-editable="true">
                  <div class="timeline-date">2019 - 2021</div>
                  <h4 class="timeline-title">Diseñadora Gráfica</h4>
                  <div class="timeline-company">Agencia Branding Solutions</div>
                  <p>Diseñé identidades visuales, material promocional y sitios web para pequeñas y medianas empresas.</p>
                </div>
              </div>
              <div class="small-muted mt-2">Tip: Haz clic en el texto para editar. Puedes añadir o eliminar contenido si lo deseas.</div>
            </div>
          </div>
        </div>

        <!-- Right column -->
        <div class="col-lg-4">
          <!-- Contact -->
          <div class="card mb-4" id="contactCard" data-section="contact">
            <div class="card-header"><h3 class="card-title">Información de Contacto</h3></div>
            <div class="card-body" id="contactBody">
              <div class="mb-3" data-editable="true">
                <strong><i class="fas fa-envelope me-2 text-primary"></i> Email</strong>
                <p class="mb-0 editable-field">ana.garcia@ejemplo.com</p>
              </div>
              <div class="mb-3" data-editable="true">
                <strong><i class="fas fa-phone me-2 text-primary"></i> Teléfono</strong>
                <p class="mb-0 editable-field">+52 322 555 7890</p>
              </div>
              <div class="mb-3" data-editable="true">
                <strong><i class="fas fa-map-marker-alt me-2 text-primary"></i> Ubicación</strong>
                <p class="mb-0 editable-field">Puerto Vallarta, Jalisco, México</p>
              </div>
              <div class="mb-3" data-editable="true">
                <strong><i class="fas fa-globe me-2 text-primary"></i> Sitio Web</strong>
                <p class="mb-0 editable-field">www.anagarcia-design.com</p>
              </div>
            </div>
          </div>

          <!-- Skills -->
          <div class="card mb-4" id="skillsCard" data-section="skills">
            <div class="card-header"><h3 class="card-title">Habilidades</h3></div>
            <div class="card-body" id="skillsBody">
              <!-- skill template entries -->
              <div class="skill-item" data-index="0">
                <div class="skill-name d-flex justify-content-between align-items-center">
                  <span class="skill-text" data-editable="true">Diseño de Marca</span>
                  <span class="skill-percent">95%</span>
                </div>
                <div class="skill-bar mt-1"><div class="skill-level" style="width:95%"></div></div>
              </div>

              <div class="skill-item" data-index="1">
                <div class="skill-name d-flex justify-content-between align-items-center">
                  <span class="skill-text" data-editable="true">Ilustración Digital</span>
                  <span class="skill-percent">90%</span>
                </div>
                <div class="skill-bar mt-1"><div class="skill-level" style="width:90%"></div></div>
              </div>

              <div class="skill-item" data-index="2">
                <div class="skill-name d-flex justify-content-between align-items-center">
                  <span class="skill-text" data-editable="true">Diseño UX/UI</span>
                  <span class="skill-percent">85%</span>
                </div>
                <div class="skill-bar mt-1"><div class="skill-level" style="width:85%"></div></div>
              </div>

              <div class="skill-item" data-index="3">
                <div class="skill-name d-flex justify-content-between align-items-center">
                  <span class="skill-text" data-editable="true">Adobe Creative Suite</span>
                  <span class="skill-percent">95%</span>
                </div>
                <div class="skill-bar mt-1"><div class="skill-level" style="width:95%"></div></div>
              </div>

              <div class="skill-item" data-index="4">
                <div class="skill-name d-flex justify-content-between align-items-center">
                  <span class="skill-text" data-editable="true">Figma</span>
                  <span class="skill-percent">80%</span>
                </div>
                <div class="skill-bar mt-1"><div class="skill-level" style="width:80%"></div></div>
              </div>

              <div class="small-muted mt-2">En modo edición puedes ajustar el porcentaje usando el control deslizante y el número.</div>
            </div>
          </div>

          <!-- Certifications -->
          <div class="card" id="certsCard" data-section="certifications">
            <div class="card-header"><h3 class="card-title">Certificaciones</h3></div>
            <div class="card-body" id="certsBody">
              <div class="mb-3" data-editable="true">
                <h5 class="mb-1 cert-title">Especialista en Diseño de Marca</h5>
                <p class="mb-1 text-muted cert-issuer">Crece Diseño</p>
                <small class="text-muted cert-date">Obtenida: Marzo 2023</small>
              </div>
              <div class="mb-3" data-editable="true">
                <h5 class="mb-1 cert-title">Diseñador UX/UI Avanzado</h5>
                <p class="mb-1 text-muted cert-issuer">Crece Diseño</p>
                <small class="text-muted cert-date">Obtenida: Enero 2023</small>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>
  
  <section class="main-content">
    <div class="container">
      <div class="profile-section">
        <div class="profile-header">
          
          <div class="profile-info">

            <div class="profile-stats">
              <div class="stat">
                <span class="stat-number" id="total-courses">0</span>
                <span class="stat-label">Cursos Totales</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="in-progress">0</span>
                <span class="stat-label">En Progreso</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="completed">0</span>
                <span class="stat-label">Completados</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de Cursos Seleccionados -->
      <div class="my-courses-section">
        <div class="courses-filter">
          <button class="filter-btn active" data-filter="all">Todos</button>
          <button class="filter-btn" data-filter="seleccionado">Seleccionados</button>
          <button class="filter-btn" data-filter="en-progreso">En Progreso</button>
          <button class="filter-btn" data-filter="completado">Completados</button>
        </div>

        <div id="no-courses-message" class="no-courses-message" style="display: none;">
          <div class="empty-state">
            <i class="fas fa-book-open"></i>
            <h4>No tienes cursos seleccionados</h4>
            <p>Visita nuestro catálogo de cursos y selecciona los que te interesen para comenzar tu formación.</p>
            <a href="./cursos.html" class="btn btn-primary">Explorar Cursos</a>
          </div>
        </div>

        <div id="my-courses-grid" class="my-courses-grid">
          <!-- Los cursos seleccionados se cargarán aquí dinámicamente -->
        </div>
      </div>
    </div>
  </section>

  <!-- Footer igual a index -->
  <footer>
    <div class="container">
      <div class="footer-container">
        <div class="footer-col">
          <h3>Crece Diseño</h3>
          <p>Catálogo de Formación para diseñadores gráficos en Puerto Vallarta.</p>
          <div class="social-links social-centered">
            <a href="https://www.instagram.com/crece_diseno?igsh=MWRtNHlvaGs4dmt0dA==" class="social-link" target="_blank" rel="noopener" aria-label="Instagram">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="https://www.tiktok.com/@mambeturouch?_r=1&_t=ZS-918cYzJJefC" class="social-link" target="_blank" rel="noopener" aria-label="TikTok">
              <i class="fab fa-tiktok"></i>
            </a>
          </div>
        </div>
        <div class="footer-col">
          <h3>Enlaces Rápidos</h3>
          <a href="../index.html#inicio">Inicio</a>
          <a href="./cursos.html">Cursos</a>
          <a href="./nosotros.html">Nosotros</a>
          <a href="../html/foro.html">Foro</a>
        </div>
        <div class="footer-col">
          <h3>Cursos</h3>
          <a href="./cursos.html#gratuitos">Cursos Gratuitos</a>
          <a href="./cursos.html#paga">Cursos de Paga</a>
          <a href="#">Certificaciones</a>
          <a href="#">Talleres</a>
        </div>
        <div class="footer-col">
          <h3>Contacto</h3>
          <p>contacto@crecediseño.com</p>
          <p>+52 322 123 4567</p>
          <p>Puerto Vallarta, Jalisco</p>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 Crece Diseño. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Botón WhatsApp igual a index -->
  <a class="whatsapp-float" target="_blank" rel="noopener"
     href="https://whatsapp.com/channel/0029VbBAW0D3LdQPDltrrs1N">
    <i class="fab fa-whatsapp"></i>
  </a>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script>
    AOS.init();

    // Navbar sticky
    (function(){
      const navbar = document.getElementById('mainNavbar');
      let lastY = window.scrollY;
      window.addEventListener('scroll', () => {
        const y = window.scrollY;
        navbar.classList.toggle('navbar-scrolled', y > 120);
        navbar.classList.toggle('navbar-hidden', y > lastY && y > 180);
        lastY = y;
      }, { passive: true });
    })();

    // --- SISTEMA DE GESTIÓN DE CURSOS DEL USUARIO ---
    document.addEventListener('DOMContentLoaded', function() {
      loadUserCourses();
      setupFilterButtons();
    });

    function loadUserCourses() {
      const selectedCourses = JSON.parse(localStorage.getItem('selectedCourses') || '{}');
      const coursesGrid = document.getElementById('my-courses-grid');
      const noCoursesMessage = document.getElementById('no-courses-message');
      
      // Actualizar estadísticas
      updateStats(selectedCourses);
      
      // Limpiar grid
      coursesGrid.innerHTML = '';
      
      if (Object.keys(selectedCourses).length === 0) {
        noCoursesMessage.style.display = 'block';
        coursesGrid.style.display = 'none';
        return;
      }
      
      noCoursesMessage.style.display = 'none';
      coursesGrid.style.display = 'grid';
      
      // Crear tarjetas para cada curso
      Object.entries(selectedCourses).forEach(([courseId, course]) => {
        const courseCard = createCourseCard(courseId, course);
        coursesGrid.appendChild(courseCard);
      });
    }

    function createCourseCard(courseId, course) {
      const card = document.createElement('div');
      card.className = 'my-course-card';
      card.setAttribute('data-status', course.status);
      
      // Determinar clase de estado
      let statusClass = '';
      let statusText = '';
      
      switch(course.status) {
        case 'seleccionado':
          statusClass = 'status-selected';
          statusText = 'Seleccionado';
          break;
        case 'en-progreso':
          statusClass = 'status-in-progress';
          statusText = 'En Progreso';
          break;
        case 'completado':
          statusClass = 'status-completed';
          statusText = 'Completado';
          break;
      }
      
      card.innerHTML = `
        <div class="my-course-header">
          <h4>${course.name}</h4>
          <span class="course-category">${course.category}</span>
        </div>
        <div class="my-course-body">
          <p class="course-description">${course.description}</p>
          <div class="course-meta">
            <span class="added-date">Agregado: ${formatDate(course.addedDate)}</span>
          </div>
          <div class="course-actions">
            <div class="status-selector">
              <label>Estado:</label>
              <select class="status-dropdown" data-course-id="${courseId}">
                <option value="seleccionado" ${course.status === 'seleccionado' ? 'selected' : ''}>Seleccionado</option>
                <option value="en-progreso" ${course.status === 'en-progreso' ? 'selected' : ''}>En Progreso</option>
                <option value="completado" ${course.status === 'completado' ? 'selected' : ''}>Completado</option>
              </select>
            </div>
            <button class="btn-remove-course" data-course-id="${courseId}">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        </div>
        <div class="my-course-status ${statusClass}">
          <span>${statusText}</span>
        </div>
      `;
      
      return card;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('es-MX', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    function updateStats(courses) {
      const total = Object.keys(courses).length;
      const inProgress = Object.values(courses).filter(course => course.status === 'en-progreso').length;
      const completed = Object.values(courses).filter(course => course.status === 'completado').length;
      
      document.getElementById('total-courses').textContent = total;
      document.getElementById('in-progress').textContent = inProgress;
      document.getElementById('completed').textContent = completed;
    }

    function setupFilterButtons() {
      const filterButtons = document.querySelectorAll('.courses-filter .filter-btn');
      
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          // Actualizar botones activos
          filterButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // Filtrar cursos
          const filter = this.getAttribute('data-filter');
          filterCourses(filter);
        });
      });
      
      // Configurar eventos para los dropdowns de estado
      document.addEventListener('change', function(e) {
        if (e.target.classList.contains('status-dropdown')) {
          const courseId = e.target.getAttribute('data-course-id');
          const newStatus = e.target.value;
          updateCourseStatus(courseId, newStatus);
        }
      });
      
      // Configurar eventos para los botones de eliminar
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('btn-remove-course') || 
            e.target.closest('.btn-remove-course')) {
          const button = e.target.classList.contains('btn-remove-course') ? 
                         e.target : e.target.closest('.btn-remove-course');
          const courseId = button.getAttribute('data-course-id');
          removeCourse(courseId);
        }
      });
    }

    function filterCourses(filter) {
      const courseCards = document.querySelectorAll('.my-course-card');
      
      courseCards.forEach(card => {
        if (filter === 'all' || card.getAttribute('data-status') === filter) {
          card.style.display = 'flex';
        } else {
          card.style.display = 'none';
        }
      });
    }

    function updateCourseStatus(courseId, newStatus) {
      const selectedCourses = JSON.parse(localStorage.getItem('selectedCourses') || '{}');
      
      if (selectedCourses[courseId]) {
        selectedCourses[courseId].status = newStatus;
        localStorage.setItem('selectedCourses', JSON.stringify(selectedCourses));
        
        // Recargar la vista
        loadUserCourses();
        
        // Mostrar notificación
        showNotification(`Estado del curso actualizado a "${getStatusText(newStatus)}"`);
      }
    }

    function getStatusText(status) {
      switch(status) {
        case 'seleccionado': return 'Seleccionado';
        case 'en-progreso': return 'En Progreso';
        case 'completado': return 'Completado';
        default: return status;
      }
    }

    function removeCourse(courseId) {
      if (confirm('¿Estás seguro de que quieres eliminar este curso de tu lista?')) {
        const selectedCourses = JSON.parse(localStorage.getItem('selectedCourses') || '{}');
        
        if (selectedCourses[courseId]) {
          delete selectedCourses[courseId];
          localStorage.setItem('selectedCourses', JSON.stringify(selectedCourses));
          
          // Recargar la vista
          loadUserCourses();
          
          // Mostrar notificación
          showNotification('Curso eliminado de tu lista');
        }
      }
    }

    function showNotification(message) {
      // Crear elemento de notificación
      const notification = document.createElement('div');
      notification.className = 'course-notification';
      notification.textContent = message;
      
      // Estilos para la notificación
      notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: #5B4393;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      
      // Agregar al DOM
      document.body.appendChild(notification);
      
      // Remover después de 3 segundos
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

     
   // Sections to manage
    const editableSelectors = {
      about: '#aboutBody [data-editable]',
      experience: '#experienceBody [data-editable]',
      contact: '#contactBody [data-editable]',
      certifications: '#certsBody [data-editable]',
      skills: '#skillsBody .skill-item'
    };

    const btnEdit = document.getElementById('btnEdit');
    const btnSave = document.getElementById('btnSave');
    const btnCancel = document.getElementById('btnCancel');
    const editButtons = document.getElementById('editButtons');

    // Toggle edit mode
    let isEditing = false;
    btnEdit.addEventListener('click', enterEditMode);
    btnSave.addEventListener('click', () => exitEditMode(true));
    btnCancel.addEventListener('click', () => exitEditMode(false));

    function enterEditMode() {
      isEditing = true;
      btnEdit.style.display = 'none';
      editButtons.style.display = 'inline-block';
      enableContentEditing(true);
    }

    function exitEditMode(save) {
      if (save) saveChanges();
      isEditing = false;
      btnEdit.style.display = 'inline-block';
      editButtons.style.display = 'none';
      enableContentEditing(false);
    }

    // Enable or disable contentEditable and show skill inputs during edit
    function enableContentEditing(flag) {
      // Generic editable elements
      document.querySelectorAll('[data-editable]').forEach(el => {
        el.contentEditable = flag ? "true" : "false";
        if (flag) {
          el.classList.add('editable-focused');
          // focus first editable
        } else {
          el.classList.remove('editable-focused');
        }
      });

      // Skill items need numeric inputs for percentage
      const skillItems = document.querySelectorAll('#skillsBody .skill-item');
      skillItems.forEach((item, idx) => {
        const percentSpan = item.querySelector('.skill-percent');
        const levelBar = item.querySelector('.skill-level');
        const nameSpan = item.querySelector('.skill-text');

        if (flag) {
          // Hide percent span and inject inputs
          percentSpan.style.display = 'none';
          // create container for inputs if not exists
          if (!item.querySelector('.skill-inputs')) {
            const inputs = document.createElement('div');
            inputs.className = 'skill-inputs mt-2';
            // range
            const range = document.createElement('input');
            range.type = 'range';
            range.min = 0; range.max = 100;
            const current = parseInt(levelBar.style.width) || 0;
            range.value = current;
            range.addEventListener('input', () => {
              num.value = range.value;
              levelBar.style.width = range.value + '%';
            });
            // number
            const num = document.createElement('input');
            num.type = 'number';
            num.min = 0; num.max = 100;
            num.value = current;
            num.addEventListener('input', () => {
              let v = parseInt(num.value) || 0;
              if (v < 0) v = 0; if (v > 100) v = 100;
              num.value = v;
              range.value = v;
              levelBar.style.width = v + '%';
            });
            inputs.appendChild(range);
            inputs.appendChild(num);

            item.appendChild(inputs);
          }
          nameSpan.contentEditable = "true";
          nameSpan.classList.add('editable-focused');
        } else {
          // remove inputs
          const inputs = item.querySelector('.skill-inputs');
          if (inputs) inputs.remove();
          percentSpan.style.display = 'inline';
          const width = parseInt(levelBar.style.width) || 0;
          percentSpan.textContent = width + '%';
          nameSpan.contentEditable = "false";
          nameSpan.classList.remove('editable-focused');
        }
      });
    }

    // Save changes to localStorage
    function saveChanges() {
      // Save About (store innerHTML)
      const aboutHTML = document.getElementById('aboutBody').innerHTML;
      localStorage.setItem('profile_about', aboutHTML);

      // Save Contact
      localStorage.setItem('profile_contact', document.getElementById('contactBody').innerHTML);

      // Save Experience
      localStorage.setItem('profile_experience', document.getElementById('experienceBody').innerHTML);

      // Save Certifications
      localStorage.setItem('profile_certs', document.getElementById('certsBody').innerHTML);

      // Save Skills - build array of {name,percent}
      const skills = [];
      document.querySelectorAll('#skillsBody .skill-item').forEach(item => {
        const name = item.querySelector('.skill-text').textContent.trim();
        const levelBar = item.querySelector('.skill-level');
        let percent = 0;
        // when in editing, range may exist
        const inputs = item.querySelector('.skill-inputs input[type="number"]');
        if (inputs) {
          percent = parseInt(inputs.value) || 0;
        } else {
          // read from bar or percent span
          percent = parseInt(levelBar.style.width) || parseInt((item.querySelector('.skill-percent')||{textContent:'0%'}).textContent) || 0;
        }
        if (percent < 0) percent = 0; if (percent > 100) percent = 100;
        skills.push({name, percent});
      });
      localStorage.setItem('profile_skills', JSON.stringify(skills));

      // Optional: save profile name/title
      localStorage.setItem('profile_name', document.getElementById('profileName').textContent.trim());
      localStorage.setItem('profile_title', document.getElementById('profileTitle').textContent.trim());

      // Feedback
      btnSave.textContent = 'Guardado';
      setTimeout(()=> btnSave.textContent = 'Guardar', 1200);
    }

    // Load saved data from localStorage
    function loadSavedData() {
      const about = localStorage.getItem('profile_about');
      if (about) document.getElementById('aboutBody').innerHTML = about;

      const contact = localStorage.getItem('profile_contact');
      if (contact) document.getElementById('contactBody').innerHTML = contact;

      const exp = localStorage.getItem('profile_experience');
      if (exp) document.getElementById('experienceBody').innerHTML = exp;

      const certs = localStorage.getItem('profile_certs');
      if (certs) document.getElementById('certsBody').innerHTML = certs;

      const skills = localStorage.getItem('profile_skills');
      if (skills) {
        try {
          const arr = JSON.parse(skills);
          const container = document.getElementById('skillsBody');
          container.innerHTML = ''; // rebuild
          arr.forEach((s, i) => {
            const item = document.createElement('div');
            item.className = 'skill-item';
            item.setAttribute('data-index', i);
            item.innerHTML = `
              <div class="skill-name d-flex justify-content-between align-items-center">
                <span class="skill-text" data-editable="true">${escapeHtml(s.name)}</span>
                <span class="skill-percent">${s.percent}%</span>
              </div>
              <div class="skill-bar mt-1"><div class="skill-level" style="width:${s.percent}%"></div></div>
            `;
            container.appendChild(item);
          });
        } catch(e){ console.warn('Error parsing skills', e); }
      }

      const name = localStorage.getItem('profile_name');
      if (name) document.getElementById('profileName').textContent = name;
      const title = localStorage.getItem('profile_title');
      if (title) document.getElementById('profileTitle').textContent = title;
    }

    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, function(m){ return map[m]; });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadSavedData();

      // Double-click to quickly enter edit on a block
      document.querySelectorAll('[data-editable]').forEach(el => {
        el.addEventListener('dblclick', () => {
          enterEditMode();
          el.focus();
        });
      });

      // Keep skill percent labels in sync if user edits outside editing (safety)
      document.querySelectorAll('.skill-item .skill-level').forEach(level => {
        const parent = level.closest('.skill-item');
        const percentSpan = parent.querySelector('.skill-percent');
        const update = () => { percentSpan.textContent = parseInt(level.style.width) + '%'; };
        // Mutation observer could be used, but we'll rely on input events in edit mode
        update();
      });

      // Keyboard shortcut: Ctrl+E to toggle edit
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key.toLowerCase() === 'e') {
          if (!isEditing) enterEditMode(); else exitEditMode(true);
        }
      });
    });

    // Make sure saving happens before unload to avoid losing edits accidentally
    window.addEventListener('beforeunload', (e) => {
      if (isEditing) {
        // Save automatically
        saveChanges();
      }
    });
  </script>
<style>
  
    body { font-family: 'Quicksand', sans-serif; color: var(--text-dark); background-color: var(--bg-light); line-height: 1.6;}
    h1,h2,h3,h4,h5,h6{ font-family:'Montserrat',sans-serif; font-weight:600; }
    .profile-header{ background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color:white; padding:3.5rem 0 2rem; margin-bottom:2rem; }
    .profile-avatar{ width:150px; height:150px; border-radius:50%; border:5px solid white; object-fit:cover; box-shadow:var(--shadow);}
    .profile-name{ font-size:2rem; font-weight:700; margin-top:1rem;}
    .btn-edit{ background-color: white; color: var(--primary-color); border: none; border-radius: 50px; padding: 0.5rem 1.25rem; font-weight:600; }
    .card{ border:none; border-radius:12px; box-shadow:var(--shadow); margin-bottom:1.5rem;}
    .skill-bar{ height:8px; background-color:#e9ecef; border-radius:4px; overflow:hidden;}
    .skill-level{ height:100%; background: linear-gradient(to right, var(--primary-color), var(--accent-color)); border-radius:4px;}
    .editable-focused{ outline: 2px dashed rgba(74,108,247,0.35); padding:0.25rem; border-radius:6px;}
    .edit-controls{ display:flex; gap:0.5rem; justify-content:center; margin-top:1rem; }
    .small-muted{ color:var(--text-light); font-size:0.9rem; }
    .btn-cancel{ background:#f8f9fa; border:1px solid #ddd; color:#333; }
    .skill-inputs{ display:flex; gap:0.5rem; align-items:center; }
    .skill-inputs input[type="range"]{ width:120px; }
    .skill-inputs input[type="number"]{ width:60px; }
  </style>

</body>
</html>